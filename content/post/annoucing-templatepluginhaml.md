+++
title = "Annoucing Template::Plugin::Haml"
date = 2010-07-21T08:10:00Z
updated = 2010-07-21T08:10:03Z
tags = ["Template::Plugin::Haml", "templates", "cgi",  "perl", "haml", "Template Toolkit"]
blogimport = true 
type = "post"
+++

A few months ago we had an assignment in Web Server Admin to create a CGI page, of course the perl was just to print text not actually do anything more, but I decided to use <a href="http://perldoc.perl.org/CGI.html">CGI.pm</a> just because I never had. The whole thing was nothing more than hello world.<br /><script src="http://gist.github.com/484350.js"></script><noscript><pre><code>#!/usr/bin/env perl<br />use 5.012;<br />use CGI qw(:standard);<br /><br />say header,<br />    start_html('hello world'),<br />    h1('hello world'),<br />    end_html;<br /></code></pre></noscript>and I thought, wow I can write all that html with just that? why can't I use that syntax as a templating language. Of course when I asked I got imbecilic responses of how bad CGI.pm was or how it used function calls is stupid. And I was put on to <a href="http://search.cpan.org/dist/Template-Declare/lib/Template/Declare.pm">Template::Declare</a> and another which I don't recall. Template Declare would be nice if it didn't require the templates to be in a Perl file.<br /><br />At some point I discovered <a href="http://haml-lang.com/">Haml</a>, simple and shorter than writing out the full HTML, unfortunately it was still longer than the CGI syntax and whitespace sensitive. But I kept looking through it. it has variables, but no loops, conditionals, or includes. So for a templating language it's simplistic or immature. I got around to googling "Haml Perl" and found <a href="http://stackoverflow.com/questions/1816530/how-can-i-use-haml-with-catalyst">this on StackOverflow</a> (of course without my post). I thought well, shouldn't be too hard to make <a href="http://search.cpan.org/dist/Text-Haml/lib/Text/Haml.pm">Text::Haml</a> into a Catalyst View or ... better yet a Plugin to <a href="http://template-toolkit.org/">Template Toolkit</a> so we can get all the goodies Haml is missing.<br /><br />After some <a href="http://stackoverflow.com/questions/3285934/trying-to-create-templatepluginfilter-for-haml">bumps</a> in the road, I managed to make a <a href="http://search.cpan.org/dist/Template-Plugin-Haml/lib/Template/Plugin/Haml.pm">finished product</a>.<br /><br />Here's some code <script src="http://gist.github.com/484389.js"> </script><noscript><pre><code>[%- USE Haml -%]<br />[%- FILTER haml -%]<br />!!! 5<br />%html<br /> %head<br />  %meta{:charset => "utf-8"}<br />  %title hello<br /> %body<br />  %p hello world<br />  %ul<br />  [%- total=0; WHILE total < 5 %]<br />   %li [% total=total+1 %][% total %]<br />  [%- END -%]<br />[%- END -%]<br /></code></pre></noscript> and its output <script src="http://gist.github.com/484391.js"> </script><noscript><a href="http://gist.github.com/484391">link to gist</a></noscript><br /><br />Since Haml is whitespace sensitive you have to be careful about how you strip (or don't strip) whitespace from TT code. Obviously this is a simple example, I have no idea how well this works in a larger codebase, and since there's no XS module for Text::Haml I don't know how well it performs. I hope it's useful for someone though.<div class="blogger-post-footer"><br />--<br />
This <span xmlns:dc="http://purl.org/dc/elements/1.1/" href="http://purl.org/dc/dcmitype/Text" rel="dc:type">work</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://www.xenoterracide.com" property="cc:attributionName" rel="cc:attributionURL">Caleb Cushing</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License</a>.</div>
