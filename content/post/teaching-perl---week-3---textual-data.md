+++
title = "Teaching Perl - Week 3 - Textual Data"
date = 2010-05-03T06:44:00Z
updated = 2010-05-03T06:54:11Z
tags = [ "perl", "teaching perl", "curriculum"]
blogimport = true 
type = "post"
+++

So <a href="http://xenoterracide.blogspot.com/2010/04/teaching-perl-week-2.html">last</a> <a href="http://xenoterracide.blogspot.com/2010/04/teaching-perl-week-2-part2.html">week</a> you should have covered variables, conditionals, flow control statements, calling functions, stdin/out/err, and using new perl features.<br /><br />This week we're covering text processing, scalars, external libraries, and reinforcing what we learned last week. Text Processing is one of Perl's specialty's, mostly due to it's powerful regular expression engine.<br /><br />First install LWP with cpan. <code>cpanp -i Bundle::LWP</code> will do it.<br /><script src="http://gist.github.com/387382.js"></script><noscript><pre><code>#!/usr/bin/perl<br />use strict;<br />use warnings;<br />use LWP::Simple;<br /><br />getprint("http://aur.archlinux.org/packages/modern-perl/modern-perl/PKGBUILD");</code></pre></noscript><br />So this is almost completely new... what does it do? and what does it have to do with text?<br /><br />LWP is short for lib www perl. LWP::Simple is a simple procedural interface to it. getprint is a method which is roughly equivilant to fetch uri and print the content that you got back. So this isn't very useful... (ok it's actually quite useful if you're on arch and you want a PKGBUILD) what we want to do in this case is cut the junk and print the pkgname. As a side note, this code does the exact same thing as the python example in <a target="_blank"  href="http://www.amazon.com/Head-First-Programming-Learners-Language/dp/0596802374?ie=UTF8&tag=xenotsblog-20&link_code=btl&camp=213689&creative=392969">Head First Programming: A Learner&#39;s Guide to Programming Using the Python Language</a><img src="http://www.assoc-amazon.com/e/ir?t=xenotsblog-20&l=btl&camp=213689&creative=392969&o=1&a=0596802374" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important; padding: 0px !important" /> but is shorter if you cut the boilerplate (#! ... use strict; use warnings ), and the same length if you don't.<br /><br />Now let's have a first attempt at getting the package name shall we? We need to read the contents into a variable first.<script src="http://gist.github.com/387403.js"></script><noscript><pre><code>#!/usr/bin/perl<br />use strict;<br />use warnings;<br />use LWP::Simple;<br /><br />my $content = get("http://aur.archlinux.org/packages/modern-perl/modern-perl/PKGBUILD");<br /><br />print $content;</code></pre></noscript> note: we've changed from getprint just to get because it returns the contents to a variable. (note: still shorter than the python.) At this point the book goes into how a string is an array of characters. Perl is contextual so at this point our scalar is essentially a string but just because it's a scalar does not mean it's currently a string. In our previous examples we were handling it in a numeric context.<br /><script src="http://gist.github.com/387422.js"></script><noscript><pre><code>#!/usr/bin/perl<br />use strict;<br />use warnings;<br />use feature qw(say);<br />use LWP::Simple;<br /><br />my $content = get("http://aur.archlinux.org/packages/modern-perl/modern-perl/PKGBUILD");<br /><br />say substr($content, 281, 11);</code></pre></noscript> So here we're looking at the 11 character <a href="http://perldoc.perl.org/functions/substr.html">substring</a> past character 281. The output should be <code>modern-perl</code>. This code is horrible, what should happen if I were to change this PKGBUILD? (if this ever doesn't output modern-perl that's probably exactly what happened). Remember <code>say</code> appends a newline character to it's output <code>print</code> doesn't. We used <code>print</code> previously because the output already had a newline at the end.<br /><br />There are thousands of PKGBUILD's on AUR let's see if we can get the name from another one by changing the URI.<script src="http://gist.github.com/387447.js"></script><noscript><pre><code>#!/usr/bin/perl<br />use strict;<br />use warnings;<br />use feature qw(say);<br />use LWP::Simple;<br /><br />my $content<br />    = get('http://aur.archlinux.org/packages/perl-moose/perl-moose/PKGBUILD');<br /><br />say substr($content, 281, 11);</code></pre></noscript>The output at the time of this writing is <br /><pre><code>dirs')<br />depe<br /></code></pre>and will probably change. A newline is just another character in the scalar so nothing prevents one from being printed within the substring. Our URI got a little long here so we moved split that peace of code up to be on 2 lines for readability. Your code lines shouldn't go over 78 characters long if you can help it. A URI would be an acceptable exception though.<br /><br /><script src="http://gist.github.com/387459.js"></script><noscript><pre><code>#!/usr/bin/perl<br />use strict;<br />use warnings;<br />use feature qw(say);<br />use LWP::Simple;<br /><br />my $content<br />    = get('http://aur.archlinux.org/packages/perl-moose/perl-moose/PKGBUILD');<br /><br />my $pos = index($content, 'pkgname');<br /><br />say substr($content, $pos + 9 , 11);</code></pre></noscript> So we use the <a href="http://perldoc.perl.org/functions/index.html"><code>index</code></a> function to search the string for some text and return the position we can then use that position to get our substring. The position returned is 1 less than where the string we searched for starts. So we added the 9 to get to the string we actually want. Our output is now <pre><code>perl-moose'</code></pre>why the '? well "perl-moose" is shorter than "modern-perl" so we've got extra characters in there.<br /><br />Let's use a regular expression.<br /><script src="http://gist.github.com/387884.js"></script><noscript><pre><code>#!/usr/bin/perl<br />use strict;<br />use warnings;<br />use feature qw(say);<br />use LWP::Simple;<br /><br />my $content<br />    = get('http://aur.archlinux.org/packages/perl-moose/perl-moose/PKGBUILD');<br /><br />( my $pkgname ) = ( $content =~ /pkgname=\'([\w-]+)\'/ );<br /><br />say $pkgname if $pkgname;</code></pre></noscript> regular expressions are really their own mini language, very terse, and several dialects. Have your students go through the <a href="http://perldoc.perl.org/perlretut.html">Regular Expression Tutorial</a> and the <a href="http://perldoc.perl.org/perlre.html">Regular Expression</a> page. In short this regex looks for pkgname='something' in <code>$content</code> and takes something and puts in in <code>$pkgname</code>. the ( ) in the / / tell which part of the regex to assign to <code>$pkgname</code>. <code>[\w-]+</code> says to match 1 or more alphanumeric or _ or - characters. Regular expressions is a huge topic in and of itself. So don't spend a huge amount of time on it, they are important to know, but you don't have to master them right now.<br /><br />I'd suggest having a copy of <a target="_blank"  href="http://www.amazon.com/Regular-Expression-Pocket-Reference-Expressions/dp/0596514271?ie=UTF8&tag=xenotsblog-20&link_code=btl&camp=213689&creative=392969">Regular Expression Pocket Reference: Regular Expressions for Perl, Ruby, PHP, Python, C, Java and .NET (Pocket Reference (O&#39;Reilly))</a><img src="http://www.assoc-amazon.com/e/ir?t=xenotsblog-20&l=btl&camp=213689&creative=392969&o=1&a=0596514271" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important; padding: 0px !important" /> and possibly <a target="_blank"  href="http://www.amazon.com/Mastering-Regular-Expressions-Jeffrey-Friedl/dp/0596528124?ie=UTF8&tag=xenotsblog-20&link_code=btl&camp=213689&creative=392969">Mastering Regular Expressions</a><img src="http://www.assoc-amazon.com/e/ir?t=xenotsblog-20&l=btl&camp=213689&creative=392969&o=1&a=0596528124" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important; padding: 0px !important" /> and if you want some common recipes <a target="_blank"  href="http://www.amazon.com/Regular-Expressions-Cookbook-Jan-Goyvaerts/dp/0596520689?ie=UTF8&tag=xenotsblog-20&link_code=btl&camp=213689&creative=392969">Regular Expressions Cookbook</a><img src="http://www.assoc-amazon.com/e/ir?t=xenotsblog-20&l=btl&camp=213689&creative=392969&o=1&a=0596520689" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important; padding: 0px !important" />. You should also warn your students that although you can use regular expressions to match any kind of text, that in the case of well defined formats, such as xml, html, csv, ini and more that there are better ways of extracting data. In the cases of things like email and phone numbers they should not write their own regex's but use modules to validate such things as they will undoubtedly make mistakes doing so, and a module has been well tested.<br /><br />The example in <a target="_blank"  href="http://www.amazon.com/Head-First-Programming-Learners-Language/dp/0596802374?ie=UTF8&tag=xenotsblog-20&link_code=btl&camp=213689&creative=392969">Head First Programming: A Learner&#39;s Guide to Programming Using the Python Language</a><img src="http://www.assoc-amazon.com/e/ir?t=xenotsblog-20&l=btl&camp=213689&creative=392969&o=1&a=0596802374" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important; padding: 0px !important" /> goes on to explain how to check the page periodically for updates, and only output when a value is less than a certain amount. Since I have no idea when I'll be updating these PKGBUILDs I don't want to get into that code. It would make a good homework assignment. You can use <a href="http://perldoc.perl.org/functions/sleep.html"><code>sleep</code></a> to make sure you only fetch the code ever so often. I can guarantee barring a buggy release I won't update any PKGBUILD more than once every 86400 seconds (1 day). You'll have to check pkgver and pkgrel to see if either of them are newer than the previously fetched PKGBUILD.<div class="blogger-post-footer"><br />--<br />
This <span xmlns:dc="http://purl.org/dc/elements/1.1/" href="http://purl.org/dc/dcmitype/Text" rel="dc:type">work</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://www.xenoterracide.com" property="cc:attributionName" rel="cc:attributionURL">Caleb Cushing</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License</a>.</div>
