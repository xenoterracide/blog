+++
title = "Experience with having a non Dist::Zilla user contribute to a Dist::Zilla project (it's not hard for them or me)"
date = 2011-07-05T02:02:00Z
updated = 2011-07-05T02:07:21Z
tags = [ "perl", "git", "Dist::Zilla"]
blogimport = true 
type = "post"
+++

I've heard many times that <a href="http://dzil.org">Dist::Zilla</a> makes it harder for people to contribute to the project. This is not true, it is either unfortunately either ignorance or FUD (much like saying Linux is harder to use than Windows). Truly, there are things that some dzil users do that <i>can</i> make it harder, but it doesn't have to be that way. <a href="https://github.com/xenoterracide/Test-Version/pull/1">Michael Schwern recently contributed to one of my dzil projects without ever realizing I was using dzil, until I told him</a>. He more recently stated on twitter, "While your solution works, it seems like it makes more work for you to shield contributors from dzil". This was true in this case because I wasn't sure how to effectively move a series of multiple patches, I now know it's easy to do with git. Here's how you can allow contributors to contribute to your dzil project without causing you or them undo pain.<br /><br /><ol><li><dl><dt>Don't use anything that changes the line numbers of your source</dt><dd>Examples: don't use <a href="http://search.cpan.org/dist/Dist-Zilla-Plugin-Prepender/lib/Dist/Zilla/Plugin/Prepender.pm">DZP::Prepender</a>. Use modules like <a href="http://search.cpan.org/dist/Dist-Zilla-Plugin-OurPkgVersion/lib/Dist/Zilla/Plugin/OurPkgVersion.pm">OurPkgVersion</a> to insert VERSION, and make sure your # ABSTRACT and any pod is below the <code>1;</code> at the end of your module. This will keep the line numbers of errors in your code from being different from the final build. It's still ok to use PodWeaver as it will save you way more time than it'll hurt, so long as you follow the rules about pod being at the bottom</dd> </dl></li><br /><br /><li><dl><dt>Use a plugin that commits builds to your source control software</dt><dd> I personally recommend <a href="http://search.cpan.org/dist/Dist-Zilla-Plugin-Git/lib/Dist/Zilla/Plugin/Git/CommitBuild.pm">DZP::Git::CommitBuild</a>  </dd> </dl></li><br /><br /><br /><br /><br /><br /><li><dl><dt>Make your build branch your default branch</dt><dd>I'm not sure how to do this with just git, but on github you can go to the admin section of your repository and change the default branch there. This makes it so that when someone clone's your repository the initial checkout is of your build branch. Your build branch shouldn't require dzil, it's the final build.</dd> </dl></li><br /><br /><br /><br /><br /><br /></ol><br />Now that you have your final build branch as the default branch anyone who wants to contribute can simply clone your repo and start hacking. Their are a couple of mistakes they could make, They could either change or add files that are maintained, or pruned by dzil. This did happen when Schwern sent me patches, one of them was the addition of a .gitignore, which I already had, but is being pruned out of the build branch. I can also see it happening to meta's and makefiles. These patches can simply be rejected as unnecessary, dzil-ified, or if they are truly a bug, then they can be reported and fixed upstream.<br /><br />So what if someone sends you a pull request from <code>build/master</code>? well if it's just one or two patches, you add their remote, and do a <code>git remote update</code> and then you can <code>git log remote build/master</code> to find the sha1 of this patch. Now that you have the sha1 all you have to do is <code>git cherry-pick [sha1]</code> and it should apply. If there are any conflicts you may have to resolve them with <code>git mergetool</code>. However, the only conflict with Schwern's patches for me was the .gitignore, all other patches applied without assistance and applied correcly, surprisingly even the pod patch applied without issue.<br /><br />If you have more patches than is comfortable with <code>git cherry-pick</code> then you need <code>git rebase</code>. The command you want is <code>git rebase -i --onto master [sha1 before first sha1 in series] [tip of remote branch checkout]</code>. So in my case <code>git rebase -i --onto master 3f1e3748 schwern</code>. What this appears to do is ends up rewriting my local schwern/build/master checkout and removes all the build commits, and then applies the patches on top. This means I can now do <code>git merge schwern</code> from the master branch, and all of his patches that I want will be successfully merged. For more on this strategy you may want to read <a href="http://stackoverflow.com/questions/1994463/how-to-cherry-pick-a-range-of-commits-and-merge-into-another-branch">this stackoverflow question</a>.<br /><br />given this is not quite as easy as a <code>git pull</code> that's a fast forward, but reality is it's not that hard once you know how to do the rebase and how it works. Of course this isn't ideal for constant contributors, those should simply learn to use dzil, but for the random contributor it should be ok.<div class="blogger-post-footer"><br />--<br />
This <span xmlns:dc="http://purl.org/dc/elements/1.1/" href="http://purl.org/dc/dcmitype/Text" rel="dc:type">work</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://www.xenoterracide.com" property="cc:attributionName" rel="cc:attributionURL">Caleb Cushing</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License</a>.</div>
