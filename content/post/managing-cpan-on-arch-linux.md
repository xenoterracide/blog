+++
title = "Managing CPAN on Arch Linux"
date = 2010-03-14T00:45:00Z
updated = 2010-03-17T16:17:37Z
tags = ["Linux", "Arch", "CPANPLUS", "install", "cpan",  "perl", "CPANPLUS::Dist::Arch"]
blogimport = true 
type = "post"
+++

So if you're running Arch Linux and want to install a bunch of packages from CPAN the best way is NOT to use the official cpan client, or even the new cpanminus. No your best bet is to use AUR or lacking AUR packages, create your own, and I'm gonna walk you through how I do it. The really nice thing about installing packages with Pacman is that unlike cpan there is a utility to uninstall them.<br /><br />The first thing you'll want is a utility that allows you to easily manage aur. Right now the Recommended tool appears to be a CLI utility called <a href="http://aur.archlinux.org/packages.php?ID=33378">packer</a> you'll want to download the <a href="http://wiki.archlinux.org/index.php/PKGBUILD">PKGBUILD</a>, on the packer page, to a directory of it's own and run <code><a href="http://wiki.archlinux.org/index.php/Makepkg">makepkg</a> -s</code> in that directory and then (as root) <code><a href="http://wiki.archlinux.org/index.php/Pacman">pacman</a> -U pkgname-pkgver.pkg.tar.gz</code>. You've now installed Packer, which means you'll never have to install an AUR package like that again (barring a new install of arch). If you really want you can stop now and just use the packages provided by arch, myself, and other aur contributors. The general conversion in name is is the CPAN module DBIx::Class becomes perl-dbix-class. However running <code>packer dbix-class</code> will find it. packer is capable of searching all of aur and the official repositories and giving you options if more than one is available. If you want to learn how to make your own packages, or just plain ignore aur and use cpanp to install read on.<br /><br />So now you'll want to install CPANPLUS with packer. This is easy just run <code>packer perl-cpanplus</code>. This should install CPANPLUS and any of its deps. Now install <a href="http://search.cpan.org/dist/CPANPLUS-Dist-Arch/">CPANPLUS::Dist::Arch</a><br />with <code>packer perl-cpanplus-dist-arch</code>. There are other 'cpan' options but this is the only one that's on both CPAN and AUR, and it has some really nice functionality.<br /><br />Now you have your entire installer stack but you still need to configure C::D::A. Run <code>setupdistarch</code>. This will configure cpanplus to automatically create any package it creates as an Arch pkg, it can even install them. For example <code>packer perl-moose</code> and <code>cpanp -i Moose</code> will both install Moose with Pacman. The first will use the package I've uploaded to AUR and the second will use C::D::A to create one (which is exactly what I did).<br /><br />So now you know the basics of Installing packages, but I'm guessing you still want to know, how I'm managing over 200 perl packages. C::D::A is actually making this easier all the time (esp since I talk to the author). first you'll want to create a directory to store all your AUR packages, the name isn't important. So you'll want to create your first package like <code>cpan2aur -d Catalyst::Runtime</code> you'll note that this creates the directory <code>perl-catalyst-runtime</code> in that directory there is a <code>PKGBUILD.tt</code> it contains syntax similar to Template::Toolkit, it is however home grown by the author of C::D::A. you can use it to add stuff the the resulting PKGBUILD. To create the PKGBUILD you'll run <code>cpan2aur perl-catalyst-runtime</code> it will create the PKGBUILD and the tarball for AUR. However, if you're really planning on making this for AUR and no package is on AUR or you own the one on AUR you can just run <code>cpan2aur -u perl-catalyst-runtime</code> and it will create all the aforementioned things plus upload them with your AUR account. It's worth noting that if you attempt to run <code>cpan2aur <directory></code> and a PKGBUILD already exists it will ask you if you wish to overwrite, unless you've made changes to it say yes, if you aren't updating to a new version on cpan it will ask if you want to update the pkgrel. I specifically requested that because it was annoying to increment by hand and I needed to update the PKGBUILD because of things like dep or provides changes.<br /><br />Unfortunately cpan2aur cannnot generate an entire dep tree worth of directories. It's worth saying that you don't really have to run cpan2aur -d at all, you could just go right to cpan2aur -u, but then you'd miss out on the wonder that is cpan2aur --check. You can run <code>cpan2aur --check perl-*</code> and it will automagically check for updates of any directory that starts with perl- and upload the updates to AUR.<br /><br />Unfortunately C::D::A has some limitations. The first is that it really Doesn't use Template Toolkit or even Template::Tiny (which I suggested). This doesn't seem to matter to much... but I wonder if it could help me with the other problem. C::D::A can't correctly determine optdepends because it gets the deps from the generated Makefiles. I'm not sure if this could be fixed or not, I don't yet understand this part of making CPAN packages enough.<br /><br />Happy packaging.<br /><br />UPDATE: <br /><br />you don't need <code>cpan2aur -u --check</code>, <code>cpan2aur --check</code> implies -u<div class="blogger-post-footer"><br />--<br />
This <span xmlns:dc="http://purl.org/dc/elements/1.1/" href="http://purl.org/dc/dcmitype/Text" rel="dc:type">work</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://www.xenoterracide.com" property="cc:attributionName" rel="cc:attributionURL">Caleb Cushing</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License</a>.</div>
