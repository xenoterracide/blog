+++
title = "Test::Version under maintenance again"
date = 2011-06-01T09:50:00Z
updated = 2011-06-01T09:53:11Z
tags = ["Test::Version", "perl"]
blogimport = true 
type = "post"
+++

About 4 months ago <a href="https://github.com/russoz">russoz (Alexei Znamensky)</a> sent me a message about quoting the versions generated by <a href="http://search.cpan.org/dist/Dist-Zilla-Plugin-OurPkgVersion/lib/Dist/Zilla/Plugin/OurPkgVersion.pm">Dist::Zilla::Plugin::OurPkgVersion</a>. I was a bit skeptical at first about needing it, and the suggestion seemed to have more to do with style anyways. But after digging a little I found to my horror that OurPkgVersion  was generating completely invalid multipart version strings, e.g:<br /><br /><code>our VERSION = 0.1.0;</code><br /><br />Which doesn't work. I was shocked because I was using <a href="http://search.cpan.org/dist/Test-HasVersion/HasVersion.pm">Test::HasVersion</a>. Well all Test::HasVersion does it checks to see that you have a VERSION defined. My code above will pass a defined test, but you certainly won't get anything if you try to print it.<br /><br />So I accepted <a href="https://github.com/xenoterracide/Dist-Zilla-Plugin-OurPkgVersion/commit/59cec9f0309a92dafc1e35f397790473669078c8">Russoz's patch</a> and fixed up my documentation. Still, I was disturbed that there weren't any Test modules that would have caught this error for me.<br /><br />So, eventually, I began working on writing a Test module to do this task for me. First it was mostly research and learning which modules and methods I would need. One of the hardest parts was determining how best to extract the VERSION from the module. PPI seemed like an impossible task, probably most due to the fact that I don't understand it. I thought about require-ing modules, but many told me that could lead to a vulnerability in the test. Ultimately decided to use <a href="http://search.cpan.org/dist/Module-Extract-VERSION/lib/Module/Extract/VERSION.pm">Module::Extract::VERSION</a> which will work for everything except perl 5.12 style versions. Then I had the problem of learning how to write Tests for Test modules, which ultimately <a href="https://github.com/doherty">doherty (Mike Doherty)</a> contributed some patches to get my first set of tests working.<br /><br />Once the module was all but finished functionality wise I had to decide on the name, after discussing it on #distzilla it was decided that it might be a good idea to take over an existing module. Test::Version seemed like the most obvious candidate because it has the most obvious namespace for what is trying to be done. So I spent the next few weeks trying to contact <a href="https://github.com/particle">particle (Jerry Gay)</a> to get maintainer-ship. Once I did manage to contact him it wasn't an issue to get control of the Module.<br /><br />So I released a new version of the old Test::Version 0.03 announcing new maintainership, on the off chance anyone was using it in the darkpan, since I'd already searched the CPAN archives for any usage and no current module was. I then released a TRIAL version for testing. The Trial version ended up having several failing tests by cpan tester reports, I thought it was caused by <a href="http://perldoc.perl.org/Test/Builder/Tester.html">Test::Builder::Tester</a> whitespace sensitivity (and maybe some of it was). <a href="https://github.com/rjbs">rjbs (Ricardo Signes)</a> suggested <a href=" ">Test::Tester</a> and I released yet another version with failing tests. This time I analyzed about 5 of the test reports, and come to find out the module seems to run the tests on the perl modules in no particular order. I assume that somewhere there is some speed optimization which results in this behavior. So I had to find a way to write the tests which could handle the fact that I couldn't depend on the order that files were being tested. Ultimately worked that kink out as well in a way that appears to be satisfactory.<br /><br />So with version 0.07 we now appear to have a working <a href="http://search.cpan.org/dist/Test-Version/lib/Test/Version.pm">Test::Version</a>. That checks to see if modules have versions, and that they are valid. It's also capable of checking an entire dist. The docs describe use, and if you use Dist::Zilla you can check out <a href="http://search.cpan.org/dist/Dist-Zilla-Plugin-Test-Version/lib/Dist/Zilla/Plugin/Test/Version.pm">Dist::Zilla::Plugin::Test::Version</a> or use <a href="http://search.cpan.org/dist/Dist-Zilla-PluginBundle-TestingMania/lib/Dist/Zilla/PluginBundle/TestingMania.pm">Dist::Zilla::Plugin::TestingMania</a> which will be including it.<br /><br />Going forward I plan to take version 0.07  if it turns out to have no serious bugs, and release version 1.0.0 as it stands. After that I have a few features releases in mind. Including supporting <code>is_strict</code> if you'd like to make sure that your VERSION passes those tests as well. I'd also like to pull in the functionality of <a href="http://search.cpan.org/dist/Test-GreaterVersion/lib/Test/GreaterVersion.pm">Test::GreaterVersion</a> and <a href="http://search.cpan.org/dist/Test-ConsistentVersion/lib/Test/ConsistentVersion.pm">Test::ConsistentVersion</a>. I'm open to other suggestions as well.<br /><br />I hope people can make some good use out of this module to avoid silly mistakes like I made.<br /><br />Happy Testing!<div class="blogger-post-footer"><br />--<br />
This <span xmlns:dc="http://purl.org/dc/elements/1.1/" href="http://purl.org/dc/dcmitype/Text" rel="dc:type">work</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://www.xenoterracide.com" property="cc:attributionName" rel="cc:attributionURL">Caleb Cushing</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License</a>.</div>
