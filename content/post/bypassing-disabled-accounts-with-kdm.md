+++
title = "Bypassing disabled accounts with KDM"
date = 2009-11-16T19:06:00Z
updated = 2009-11-18T00:48:43Z
tags = ["Arch", "security", "authentication", "kdm", "pam", "accounts", "hall of shame", "kde", "kde4"]
blogimport = true 
type = "post"
+++

So the most common way of disabling an account in a unix system is changing the users shell in /etc/passwd to /bin/false or /sbin/nologin. However, I've discovered on Arch Linux that if I do this only shell login's are disabled, I was still able to log the user in with gui via kdm. I also tried using usermod --expiredate 1. this was not effective either however. the only way I found to lock the account from kdm login was to do a passwd -l accountname, which only locks password authentication. This means key and token authentication should still work. My real concern is that if the user was set to login without a password that it would still be bypass-able. My personal opinion is that I shouldn't have to do more than 1 thing  to disable a user account in a 100% effective manner. Currently Arch Linux (and maybe more) fails at this. I'll post a fix later as I investigate further.<br /><br />Bugs I filed are at <a href="https://bugs.kde.org/show_bug.cgi?id=214616">kde</a> and <a href="http://bugs.archlinux.org/task/17157">Arch Linux</a><br /><br />EDIT: expire date worked... just not immediately, very odd.<br /><br />EDIT: Here's a proper /etc/pam.d/kde<br /><pre><code><br />#%PAM-1.0<br />auth        required    pam_nologin.so<br />auth        required    pam_unix.so nullok<br />auth        required    pam_shells.so<br />auth required pam_tally.so onerr=succeedfile=/var/log/faillog<br />account     required    pam_access.so<br />account     required    pam_time.so<br />account     required    pam_unix.so<br />password    required    pam_unix.so<br />session     required    pam_unix.so<br />session     required    pam_env.so<br />session     required    pam_limits.so<br /></pre></code><div class="blogger-post-footer"><br />--<br />
This <span xmlns:dc="http://purl.org/dc/elements/1.1/" href="http://purl.org/dc/dcmitype/Text" rel="dc:type">work</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://www.xenoterracide.com" property="cc:attributionName" rel="cc:attributionURL">Caleb Cushing</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License</a>.</div>
